# Use Jenkins base image (supports ARM64)
FROM jenkins/jenkins:lts

# Switch to root user to install Docker CLI
USER root

# Install Docker using official script (compatible with ARM64/M1)
RUN apt-get update && \
    apt-get install -y curl gnupg lsb-release && \
    curl -fsSL https://get.docker.com | sh

# Add jenkins user to docker group
RUN groupadd -f docker && usermod -aG docker jenkins

# Optional: Create Docker lib directory (if using DinD, not socket sharing)
RUN mkdir -p /var/lib/docker
VOLUME /var/lib/docker

# Switch back to Jenkins user
USER jenkins